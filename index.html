<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SuperSix - Tasks Simplified</title>
  <link rel="icon" type="image/x-icon" href="/favicon.ico">
  <!-- Content Security Policy -->
  <meta http-equiv="Content-Security-Policy" content="default-src 'none'; script-src 'self' https://unpkg.com https://cdnjs.cloudflare.com https://cdn.tailwindcss.com 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://cdn.tailwindcss.com; connect-src 'self'; img-src 'self' data:; font-src 'self'; manifest-src 'self'; base-uri 'self'; form-action 'self';">

  <!-- Web App Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/apple-touch-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/apple-touch-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/apple-touch-icon-120x120.png">
  <!-- Android Chrome Icons -->
  <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
  <!-- Standard Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  <!-- Theme color for Android -->
  <meta name="theme-color" content="#0891b2">
  <!-- Apple Web App settings -->
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="SuperSix">

  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    // Configure Tailwind
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          animation: {
            'fade-in': 'fadeIn 0.5s ease-in-out',
            'slide-in': 'slideIn 0.3s ease-out',
            'pulse-slow': 'pulse 3s infinite',
          }
        }
      }
    }
  </script>
</head>

<body class="bg-slate-900">
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

    // Lucide React icons (simplified versions)
    const Icon = ({ name, size = 16, className = "", ...props }) => {
      const iconPaths = {
        'trash-2': 'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2M10 11v6M14 11v6',
        'check': 'M9 12l2 2 4-4',
        'clock': 'M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10z M12 6v6l4 2',
        'edit-3': 'M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7 M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z',
        'chevron-up': 'M18 15l-6-6-6 6',
        'chevron-down': 'M6 9l6 6 6-6',
        'arrow-up': 'M12 19V5M5 12l7-7 7 7',
        'arrow-down': 'M12 5v14M19 12l-7 7-7-7',
        'menu': 'M3 12h18M3 6h18M3 18h18',
        'x': 'M18 6L6 18M6 6l12 12',
        'plus': 'M12 5v14M5 12h14',
        'more-vertical': 'M12 12h.01M12 5h.01M12 19h.01',
        'archive': 'M21 8v13H3V8M1 3h22v5H1zM10 12l4 4 4-4',
        'edit': 'M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7',
        'trash': 'M3 6h18m-2 0v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2',
        'user': 'M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 3a4 4 0 100 8 4 4 0 000-8z',
        'log-out': 'M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9',
        'eye': 'M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z M12 9a3 3 0 100 6 3 3 0 000-6z',
        'eye-off': 'M17.94 17.94A10.07 10.07 0 0112 20c-7 0-11-8-11-8a18.45 18.45 0 015.06-5.94M9.9 4.24A9.12 9.12 0 0112 4c7 0 11 8 11 8a18.5 18.5 0 01-2.16 3.19M15 12a3 3 0 11-6 0 3 3 0 016 0z M1 1l22 22'
      };

      return React.createElement('svg', {
        width: size,
        height: size,
        viewBox: '0 0 24 24',
        fill: 'none',
        stroke: 'currentColor',
        strokeWidth: 2,
        strokeLinecap: 'round',
        strokeLinejoin: 'round',
        className,
        ...props
      }, React.createElement('path', { d: iconPaths[name] }));
    };

    // API Configuration
    const API_BASE_URL = '/api'; // Adjust this to match your server setup

    // API Service with authentication
    const api = {
      onAuthFailure: null,
      csrfToken: null,

      setAuthFailureCallback(callback) {
        this.onAuthFailure = callback;
      },

      async fetchCsrfToken() {
        if (!this.csrfToken) {
          const res = await fetch(`${API_BASE_URL}/auth.php?action=csrf`, {
            credentials: 'include',
          });
          if (res.ok) {
            const data = await res.json();
            this.csrfToken = data.csrf_token;
          }
        }
        return this.csrfToken;
      },

      clearCsrfToken() {
        this.csrfToken = null;
      },

      async request(endpoint, options = {}) {
        const url = `${API_BASE_URL}${endpoint}`;
        const method = (options.method || 'GET').toUpperCase();
        const isMutating = ['POST', 'PUT', 'DELETE'].includes(method);

        const headers = {
          'Content-Type': 'application/json',
          ...options.headers,
        };

        if (isMutating) {
          const token = await this.fetchCsrfToken();
          if (token) {
            headers['X-CSRF-Token'] = token;
          }
        }

        const config = {
          ...options,
          headers,
          credentials: 'include',
        };

        const response = await fetch(url, config);

        if (response.status === 401) {
          if (this.onAuthFailure) {
            this.onAuthFailure('session_expired');
          }
          throw new Error('Session expired');
        }

        if (response.status === 403) {
          // CSRF token may have expired — clear and retry once
          this.clearCsrfToken();
          const retryToken = await this.fetchCsrfToken();
          if (retryToken) {
            headers['X-CSRF-Token'] = retryToken;
            const retryResponse = await fetch(url, { ...config, headers });
            if (!retryResponse.ok) {
              const error = await retryResponse.json().catch(() => ({ error: 'Request failed' }));
              throw new Error(error.error || `HTTP ${retryResponse.status}`);
            }
            return retryResponse.json();
          }
        }

        if (!response.ok) {
          const error = await response.json().catch(() => ({ error: 'Network error' }));
          throw new Error(error.error || `HTTP ${response.status}`);
        }

        return response.json();
      },

      // Auth endpoints
      async register(name, email, password, remember = false) {
        return this.request('/auth.php?action=register', {
          method: 'POST',
          body: JSON.stringify({ name, email, password, remember }),
        });
      },

      // Subtask endpoints
      async getSubtasks(taskId) {
        return this.request(`/subtasks.php?task_id=${taskId}`);
      },

      async createSubtask(taskId, title) {
        return this.request('/subtasks.php', {
          method: 'POST',
          body: JSON.stringify({ task_id: taskId, title }),
        });
      },

      async toggleSubtask(subtaskId) {
        return this.request('/subtasks.php?action=toggle', {
          method: 'POST',
          body: JSON.stringify({ id: subtaskId }),
        });
      },

      async deleteSubtask(subtaskId) {
        return this.request(`/subtasks.php?id=${subtaskId}`, {
          method: 'DELETE',
        });
      },

      async login(email, password, remember = false) {
        return this.request('/auth.php?action=login', {
          method: 'POST',
          body: JSON.stringify({ email, password, remember }),
        });
      },

      async logout() {
        return this.request('/auth.php?action=logout', {
          method: 'POST',
        });
      },

      async getCurrentUser() {
        return this.request('/auth.php?action=me');
      },

      async resendVerification() {
        return this.request('/auth.php?action=resend');
      },

      // Board endpoints (unchanged but now authenticated)
      async getBoards() {
        return this.request('/boards.php');
      },

      async createBoard(name, color) {
        return this.request('/boards.php', {
          method: 'POST',
          body: JSON.stringify({ name, color }),
        });
      },

      async updateBoard(id, name) {
        return this.request('/boards.php', {
          method: 'PUT',
          body: JSON.stringify({ id, name }),
        });
      },

      async deleteBoard(id) {
        return this.request(`/boards.php?id=${id}`, {
          method: 'DELETE',
        });
      },

      // Task endpoints (unchanged but now authenticated)
      async getTasks(boardId) {
        return this.request(`/tasks.php?board_id=${boardId}`);
      },

      async createTask(boardId, title, description = '', dueDate = null) {
        return this.request('/tasks.php', {
          method: 'POST',
          body: JSON.stringify({
            board_id: boardId,
            title,
            description,
            dueDate
          }),
        });
      },

      async updateTask(id, title, description, dueDate) {
        return this.request('/tasks.php', {
          method: 'PUT',
          body: JSON.stringify({ id, title, description, dueDate }),
        });
      },

      async deleteTask(id) {
        return this.request(`/tasks.php?id=${id}`, {
          method: 'DELETE',
        });
      },

      async completeTask(id) {
        return this.request('/tasks.php?action=complete', {
          method: 'POST',
          body: JSON.stringify({ id }),
        });
      },

      async promoteTask(id) {
        return this.request('/tasks.php?action=promote', {
          method: 'POST',
          body: JSON.stringify({ id }),
        });
      },

      async demoteTask(id) {
        return this.request('/tasks.php?action=demote', {
          method: 'POST',
          body: JSON.stringify({ id }),
        });
      },

      async postponeTask(id) {
        return this.request('/tasks.php?action=postpone', {
          method: 'POST',
          body: JSON.stringify({ id }),
        });
      },

      async reorderTask(id, direction) {
        return this.request('/tasks.php?action=reorder', {
          method: 'POST',
          body: JSON.stringify({ id, direction }),
        });
      },

      async undoCompleteTask(id) {
        return this.request('/tasks.php?action=undo', {
          method: 'POST',
          body: JSON.stringify({ id }),
        });
      },
    };

    // Login/Register Modal Component
    const AuthModal = ({ isOpen, onClose, onAuthSuccess, mode = 'login' }) => {
      const [isLogin, setIsLogin] = useState(mode === 'login');
      const [formData, setFormData] = useState({
        name: '',
        email: '',
        password: '',
        remember: false
      });
      const [showPassword, setShowPassword] = useState(false);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState('');

      // Update mode when prop changes
      useEffect(() => {
        setIsLogin(mode === 'login');
      }, [mode]);

      const resetForm = () => {
        setFormData({ name: '', email: '', password: '', remember: false });
        setError('');
        setShowPassword(false);
      };

      const handleSubmit = async (e) => {
        e.preventDefault();
        setLoading(true);
        setError('');

        try {
          let result;
          if (isLogin) {
            result = await api.login(formData.email, formData.password, formData.remember);
          } else {
            // Client-side password strength validation
            const pw = formData.password;
            if (pw.length < 8) throw new Error('Password must be at least 8 characters long');
            if (!/[A-Z]/.test(pw)) throw new Error('Password must contain at least one uppercase letter');
            if (!/[a-z]/.test(pw)) throw new Error('Password must contain at least one lowercase letter');
            if (!/[0-9]/.test(pw)) throw new Error('Password must contain at least one number');
            result = await api.register(formData.name, formData.email, formData.password, formData.remember);
          }

          onAuthSuccess(result.user);
          resetForm();
          onClose();
        } catch (err) {
          setError(err.message);
        } finally {
          setLoading(false);
        }
      };

      const switchMode = () => {
        setIsLogin(!isLogin);
        resetForm();
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-slate-800 rounded-lg p-6 max-w-md w-full border border-slate-700">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-white">
                {isLogin ? 'Sign In' : 'Create Account'}
              </h2>
              <button
                onClick={onClose}
                className="text-slate-400 hover:text-white"
              >
                <Icon name="x" size={20} />
              </button>
            </div>

            <form onSubmit={handleSubmit} className="space-y-4">
              {!isLogin && (
                <div>
                  <label className="block text-slate-300 text-sm font-medium mb-1">
                    Name
                  </label>
                  <input
                    type="text"
                    value={formData.name}
                    onChange={(e) => setFormData({ ...formData, name: e.target.value })}
                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-400"
                    placeholder="Your Name"
                    required
                  />
                </div>
              )}

              <div>
                <label className="block text-slate-300 text-sm font-medium mb-1">
                  Email
                </label>
                <input
                  type="email"
                  value={formData.email}
                  onChange={(e) => setFormData({ ...formData, email: e.target.value })}
                  className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-400"
                  placeholder="your@email.com"
                  required
                />
              </div>

              <div>
                <label className="block text-slate-300 text-sm font-medium mb-1">
                  Password
                </label>
                <div className="relative">
                  <input
                    type={showPassword ? "text" : "password"}
                    value={formData.password}
                    onChange={(e) => setFormData({ ...formData, password: e.target.value })}
                    className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-400 pr-10"
                    placeholder={isLogin ? "Password" : "At least 8 characters"}
                    required
                  />
                  <button
                    type="button"
                    onClick={() => setShowPassword(!showPassword)}
                    className="absolute right-3 top-1/2 transform -translate-y-1/2 text-slate-400 hover:text-slate-300"
                  >
                    <Icon name={showPassword ? "eye-off" : "eye"} size={16} />
                  </button>
                </div>
              </div>

              <div className="flex items-center">
                <input
                  type="checkbox"
                  id="remember"
                  checked={formData.remember}
                  onChange={(e) => setFormData({ ...formData, remember: e.target.checked })}
                  className="mr-2 rounded border-slate-600 bg-slate-700"
                />
                <label htmlFor="remember" className="text-slate-300 text-sm">
                  Remember me
                </label>
              </div>

              {error && (
                <div className="bg-red-500/10 border border-red-500/20 rounded px-3 py-2">
                  <p className="text-red-400 text-sm">{error}</p>
                </div>
              )}

              <button
                type="submit"
                disabled={loading}
                className="w-full bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white py-2 px-4 rounded font-medium transition-colors"
              >
                {loading ? 'Please wait...' : (isLogin ? 'Sign In' : 'Create Account')}
              </button>
            </form>

            <div className="mt-4 text-center">
              <button
                onClick={switchMode}
                className="text-cyan-400 hover:text-cyan-300 text-sm"
              >
                {isLogin
                  ? "Don't have an account? Sign up"
                  : "Already have an account? Sign in"
                }
              </button>
            </div>
          </div>
        </div>
      );
    };

    // User Header Component
    const UserHeader = ({ user, onLogout, onOpenAuth }) => {
      const [dropdownOpen, setDropdownOpen] = useState(false);

      const handleLogout = async () => {
        try {
          await api.logout();
          onLogout();
        } catch (error) {
          console.error('Logout error:', error);
          onLogout(); // Logout anyway
        }
      };

      if (!user) {
        return (
          <div className="flex items-center space-x-2">
            <button
              onClick={() => onOpenAuth()}
              className="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded font-medium transition-colors"
            >
              Sign In
            </button>
          </div>
        );
      }

      return (
        <div className="relative">
          <button
            onClick={() => setDropdownOpen(!dropdownOpen)}
            className="flex items-center space-x-2 text-slate-300 hover:text-white transition-colors"
          >
            <div className="w-8 h-8 bg-cyan-600 rounded-full flex items-center justify-center">
              <Icon name="user" size={16} />
            </div>
            <span className="hidden sm:block">{user.name}</span>
          </button>

          {dropdownOpen && (
            <div className="absolute right-0 top-full mt-2 bg-slate-700 border border-slate-600 rounded-lg shadow-xl min-w-48 z-50">
              <div className="p-3 border-b border-slate-600">
                <p className="text-white font-medium">{user.name}</p>
                <p className="text-slate-400 text-sm">{user.email}</p>
                {!user.email_verified && (
                  <p className="text-orange-400 text-xs mt-1">Email not verified</p>
                )}
              </div>
              <button
                onClick={handleLogout}
                className="w-full px-3 py-2 text-left text-slate-300 hover:bg-slate-600 hover:text-white flex items-center space-x-2 rounded-b-lg"
              >
                <Icon name="log-out" size={14} />
                <span>Sign Out</span>
              </button>
            </div>
          )}

          {/* Click outside to close dropdown */}
          {dropdownOpen && (
            <div
              className="fixed inset-0 z-40"
              onClick={() => setDropdownOpen(false)}
            />
          )}
        </div>
      );
    };

    // Email Verification Banner Component
    const EmailVerificationBanner = ({ user, onClose }) => {
      const [sending, setSending] = useState(false);
      const [message, setMessage] = useState('');

      const handleResend = async () => {
        setSending(true);
        setMessage('');

        try {
          await api.resendVerification();
          setMessage('Verification email sent! Check your inbox.');
        } catch (error) {
          setMessage('Failed to send email. Please try again.');
        } finally {
          setSending(false);
        }
      };

      if (!user || user.email_verified) return null;

      return (
        <div className="bg-orange-500/10 border-b border-orange-500/20 px-4 py-3">
          <div className="max-w-4xl mx-auto">
            <div className="flex items-center justify-center space-x-4">
              <div className="text-center">
                <p className="text-orange-400 text-sm">
                  Please verify your email address to ensure account security. Check your inbox and spam for a verification email. If you didn't receive it:
                </p>
                {message && (
                  <p className="text-orange-300 text-xs mt-1">{message}</p>
                )}
              </div>
              <button
                onClick={handleResend}
                disabled={sending}
                className="text-orange-400 hover:text-orange-300 text-sm underline disabled:opacity-50 whitespace-nowrap"
              >
                {sending ? 'Sending...' : 'Resend'}
              </button>
            </div>
          </div>
        </div>
      );
    };

    // Loading Component
    const LoadingScreen = () => (
      <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
        <div className="text-center">
          <div className="animate-spin rounded-full h-12 w-12 border-b-2 border-cyan-400 mx-auto mb-4"></div>
          <p className="text-slate-300">Loading SuperSix...</p>
        </div>
      </div>
    );

    // Custom Task Card Component with Drag & Drop
    const TaskCard = ({ task, index, isCurrentFocus, onComplete, onPostpone, onEdit, onDelete, onMoveUp, onMoveDown, onDemote, canMoveUp, canMoveDown, isMoving, onDragStart, onDragEnd, onDragOver, onDrop, isDragOver, subtasks }) => {
      const handleDragStart = (e) => {
        e.dataTransfer.setData('text/plain', '');
        e.dataTransfer.effectAllowed = 'move';
        onDragStart(task.id, index);
      };

      const handleDragOver = (e) => {
        e.preventDefault();
        e.dataTransfer.dropEffect = 'move';
        onDragOver(index);
      };

      const handleDrop = (e) => {
        e.preventDefault();
        onDrop(index);
      };

      return (
        <div
          className={`relative bg-slate-800 rounded-lg p-4 border-2 transition-all duration-200 ease-in-out cursor-pointer hover:cursor-grab active:cursor-grabbing ${isMoving ? 'transform scale-105 shadow-lg shadow-cyan-400/20' : ''} ${isCurrentFocus ? 'border-cyan-400 shadow-lg shadow-cyan-400/20 ring-1 ring-cyan-400/30' : 'border-slate-700 hover:border-slate-600'} ${isDragOver ? 'border-green-400 bg-green-500/40 animate-pulse shadow-lg shadow-green-400/50' : ''}`}
          draggable
          onDragStart={handleDragStart}
          onDragEnd={onDragEnd}
          onDragOver={handleDragOver}
          onDrop={handleDrop}
        >
          <div className={`absolute -left-3 left-0 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold ${isCurrentFocus ? 'bg-gradient-to-r from-cyan-400 to-cyan-500 text-white shadow-lg' : 'bg-slate-700 text-slate-300'}`}>
            {index + 1}
          </div>

          {/* Keep the arrow buttons as backup/alternative */}
          <div className="absolute right-0 top-2 flex flex-col opacity-50 hover:opacity-100 transition-opacity">
            <button
              onClick={() => onMoveUp(task.id)}
              disabled={!canMoveUp}
              className={`p-1 rounded transition-all ${canMoveUp ? 'text-slate-400 hover:text-cyan-400 hover:bg-cyan-400/10 cursor-pointer' : 'text-slate-600 cursor-not-allowed'}`}
              title="Move up"
            >
              <Icon name="chevron-up" size={12} />
            </button>
            <button
              onClick={() => onMoveDown(task.id)}
              disabled={!canMoveDown}
              className={`p-1 rounded transition-all ${canMoveDown ? 'text-slate-400 hover:text-cyan-400 hover:bg-cyan-400/10 cursor-pointer' : 'text-slate-600 cursor-not-allowed'}`}
              title="Move down"
            >
              <Icon name="chevron-down" size={12} />
            </button>
          </div>

          <div className="ml-4 mr-8">
            <div className="flex justify-between items-start mb-2">
              <h3 className="font-medium text-white flex-1 mr-4">{task.title}</h3>
              {task.dueDate && (
                <div className="flex items-center space-x-1">
                  {new Date(task.dueDate) < new Date() && (
                    <span className="text-red-400 font-bold text-sm">!</span>
                  )}
                  <div className={`${new Date(task.dueDate) < new Date() ? 'bg-red-500' : 'bg-orange-500'} text-white px-2 py-1 rounded-full text-xs font-medium`}>
                    {new Date(task.dueDate).toLocaleString()}
                  </div>
                </div>
              )}
            </div>

            {task.description && (
              <p className="text-slate-300 text-sm mb-4">{task.description}</p>
            )}

            <div className="flex items-center flex-wrap gap-2">
              <button
                onClick={() => onComplete(task.id)}
                className="bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center space-x-1"
              >
                <Icon name="check" size={14} />
                <span>Complete</span>
              </button>
              <button
                onClick={() => onPostpone(task.id)}
                className="bg-blue-600 hover:bg-blue-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center space-x-1"
              >
                <Icon name="clock" size={14} />
                <span>Postpone</span>
              </button>
              <button
                onClick={() => onEdit(task.id)}
                className="bg-slate-600 hover:bg-slate-700 text-white px-3 py-1 rounded text-sm font-medium transition-colors flex items-center space-x-1"
              >
                <Icon name="edit-3" size={14} />
                <span>Edit</span>
              </button>
              <button
                onClick={() => onDemote(task.id)}
                className="border border-slate-500 text-slate-500 hover:border-slate-400 hover:text-slate-400 bg-transparent px-2 py-1 rounded text-xs font-medium transition-colors flex items-center space-x-1"
                title="Move to Queue"
              >
                <Icon name="arrow-down" size={12} />
                <span>Queue</span>
              </button>

              <button
                onClick={() => onDelete(task.id)}
                className="text-red-400 hover:text-red-300 p-1 transition-colors hover:bg-red-400/10 rounded"
                title="Delete task"
              >
                <Icon name="trash-2" size={16} />
              </button>
            </div>
            {/* Subtask Badge */}
            {subtasks[task.id] && subtasks[task.id].length > 0 && (
              <div className="mt-3 pt-3 border-t border-slate-700">
                <div className="flex items-center space-x-2">
                  <div className="bg-slate-700 text-slate-300 px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                    <Icon name="check" size={12} />
                    <span>
                      {subtasks[task.id].filter(s => s.completed).length}/{subtasks[task.id].length} completed
                    </span>
                  </div>
                  {subtasks[task.id].length > 0 && (
                    <div className="flex-1 max-w-20 bg-slate-600 rounded-full h-1.5">
                      <div
                        className="bg-green-500 h-1.5 rounded-full transition-all duration-300"
                        style={{
                          width: `${(subtasks[task.id].filter(s => s.completed).length / subtasks[task.id].length) * 100}%`
                        }}
                      />
                    </div>
                  )}
                </div>
              </div>
            )}
          </div>
        </div>
      );
    };

    // Custom Queue Card Component
    const QueueCard = ({ task, index, onEdit, onDelete, onMoveUp, onMoveDown, onPromote, canMoveUp, canMoveDown, isMoving, subtasks }) => {
      return (
        <div className={`bg-slate-800/50 rounded-lg p-3 border border-slate-700 transition-all duration-300 ease-in-out ${isMoving ? 'transform scale-105 shadow-lg shadow-cyan-400/20' : 'hover:border-slate-600'}`}>
          <div className="flex items-start justify-between">
            <div className="flex-1 mr-4">
              <div className="flex items-center space-x-2 mb-1">
                <h4 className="text-white font-medium">{task.title}</h4>
                {task.dueDate && (
                  <div className="flex items-center space-x-1">
                    {new Date(task.dueDate) < new Date() && (
                      <span className="text-red-400 font-bold text-sm">!</span>
                    )}
                    <div className={`${new Date(task.dueDate) < new Date() ? 'bg-red-500' : 'bg-orange-500'} text-white px-2 py-1 rounded-full text-xs font-medium`}>
                      {new Date(task.dueDate).toLocaleString()}
                    </div>
                  </div>
                )}
              </div>
              {task.description && (
                <p className="text-slate-400 text-sm">{task.description}</p>
              )}
            </div>

            <div className="flex items-center space-x-1">
              <button
                onClick={() => onPromote(task.id)}
                className="bg-cyan-600 hover:bg-cyan-700 text-white px-2 py-1 rounded text-xs font-medium transition-colors flex items-center space-x-1"
                title="Promote to Active"
              >
                <Icon name="arrow-up" size={12} />
                <span>Activate</span>
              </button>

              <div className="flex flex-col">
                <button
                  onClick={() => onMoveUp(task.id)}
                  disabled={!canMoveUp}
                  className={`p-1 rounded transition-all ${canMoveUp ? 'text-slate-400 hover:text-cyan-400 hover:bg-cyan-400/10 cursor-pointer' : 'text-slate-600 cursor-not-allowed'}`}
                  title="Move up in queue"
                >
                  <Icon name="chevron-up" size={12} />
                </button>
                <button
                  onClick={() => onMoveDown(task.id)}
                  disabled={!canMoveDown}
                  className={`p-1 rounded transition-all ${canMoveDown ? 'text-slate-400 hover:text-cyan-400 hover:bg-cyan-400/10 cursor-pointer' : 'text-slate-600 cursor-not-allowed'}`}
                  title="Move down in queue"
                >
                  <Icon name="chevron-down" size={12} />
                </button>
              </div>

              <button
                onClick={() => onEdit(task.id)}
                className="text-slate-400 hover:text-slate-300 p-1 transition-colors hover:bg-slate-600/50 rounded"
                title="Edit task"
              >
                <Icon name="edit-3" size={14} />
              </button>
              <button
                onClick={() => onDelete(task.id)}
                className="text-red-400 hover:text-red-300 p-1 transition-colors hover:bg-red-400/10 rounded"
                title="Delete task"
              >
                <Icon name="trash-2" size={14} />
              </button>
            </div>
          </div>

          {/* Subtask Badge */}
          {subtasks[task.id] && subtasks[task.id].length > 0 && (
            <div className="mt-3 pt-3 border-t border-slate-600">
              <div className="flex items-center space-x-2">
                <div className="bg-slate-700 text-slate-300 px-2 py-1 rounded-full text-xs font-medium flex items-center space-x-1">
                  <Icon name="check" size={10} />
                  <span>
                    {subtasks[task.id].filter(s => s.completed).length}/{subtasks[task.id].length} completed
                  </span>
                </div>
                <div className="flex-1 max-w-16 bg-slate-600 rounded-full h-1">
                  <div
                    className="bg-green-500 h-1 rounded-full transition-all duration-300"
                    style={{
                      width: `${(subtasks[task.id].filter(s => s.completed).length / subtasks[task.id].length) * 100}%`
                    }}
                  />
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };
    // Subtask Component
    const SubtaskList = ({ taskId, subtasks, onAdd, onToggle, onDelete, loading }) => {
      const [newSubtask, setNewSubtask] = useState('');

      const handleAdd = () => {
        onAdd(taskId, newSubtask);
        setNewSubtask('');
      };

      const taskSubtasks = subtasks[taskId] || [];
      const completedCount = taskSubtasks.filter(s => s.completed).length;

      return (
        <div className="space-y-3">
          <div className="flex items-center justify-between">
            <h4 className="text-slate-300 text-sm font-medium">
              Checklist ({completedCount}/{taskSubtasks.length})
            </h4>
            {taskSubtasks.length > 0 && (
              <div className="w-24 bg-slate-600 rounded-full h-2">
                <div
                  className="bg-green-500 h-2 rounded-full transition-all duration-300"
                  style={{ width: `${taskSubtasks.length > 0 ? (completedCount / taskSubtasks.length) * 100 : 0}%` }}
                />
              </div>
            )}
          </div>

          <div className="space-y-2 max-h-40 overflow-y-auto">
            {taskSubtasks.map(subtask => (
              <div
                key={subtask.id}
                className="flex items-center space-x-2 group"
              >
                <button
                  onClick={() => onToggle(subtask.id, taskId)}
                  className={`w-4 h-4 rounded border-2 flex items-center justify-center transition-all ${subtask.completed
                    ? 'bg-green-500 border-green-500 text-white'
                    : 'border-slate-500 hover:border-green-400'
                    }`}
                >
                  {subtask.completed && <Icon name="check" size={10} />}
                </button>
                <span
                  className={`flex-1 text-sm ${subtask.completed
                    ? 'text-slate-400 line-through'
                    : 'text-slate-200'
                    }`}
                >
                  {subtask.title}
                </span>
                <button
                  onClick={() => onDelete(subtask.id, taskId)}
                  className="opacity-0 group-hover:opacity-100 text-red-400 hover:text-red-300 p-1 transition-all"
                >
                  <Icon name="x" size={12} />
                </button>
              </div>
            ))}
          </div>

          <div className="flex space-x-2">
            <input
              type="text"
              value={newSubtask}
              onChange={(e) => setNewSubtask(e.target.value)}
              onKeyPress={(e) => e.key === 'Enter' && handleAdd()}
              placeholder="Add checklist item..."
              className="flex-1 bg-slate-600 border border-slate-500 rounded px-2 py-1 text-white text-sm placeholder-slate-400 focus:outline-none focus:border-cyan-400"
            />
            <button
              onClick={handleAdd}
              disabled={!newSubtask.trim() || loading}
              className="bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white px-3 py-1 rounded text-sm transition-colors"
            >
              Add
            </button>
          </div>
        </div>
      );
    };

    // Quick Add Task Modal Component
    const QuickAddModal = ({ isOpen, onClose, onAdd, loading }) => {
      const [newTask, setNewTask] = useState('');

      const handleAdd = () => {
        if (newTask.trim()) {
          onAdd(newTask.trim());
          setNewTask('');
          onClose();
        }
      };

      const handleKeyPress = (e) => {
        if (e.key === 'Enter') {
          handleAdd();
        }
      };

      if (!isOpen) return null;

      return (
        <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4">
          <div className="bg-slate-800 rounded-lg p-6 max-w-md w-full border border-slate-700">
            <div className="flex items-center justify-between mb-6">
              <h2 className="text-xl font-semibold text-white">Add Task To Queue</h2>
              <button
                onClick={onClose}
                className="text-slate-400 hover:text-white"
              >
                <Icon name="x" size={20} />
              </button>
            </div>

            <div className="space-y-4">
              <div>
                <label className="block text-slate-300 text-sm font-medium mb-1">
                  Task Title
                </label>
                <input
                  type="text"
                  value={newTask}
                  onChange={(e) => setNewTask(e.target.value)}
                  onKeyPress={handleKeyPress}
                  className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-400"
                  placeholder="What needs to get done?"
                  autoFocus
                />
              </div>
            </div>

            <div className="flex space-x-2 justify-end mt-6">
              <button
                onClick={onClose}
                className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors"
              >
                Cancel
              </button>
              <button
                onClick={handleAdd}
                disabled={!newTask.trim() || loading}
                className="px-4 py-2 bg-orange-500 hover:bg-orange-600 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded transition-colors"
              >
                {loading ? 'Adding...' : 'Add Task'}
              </button>
            </div>
          </div>
        </div>
      );
    };

    const App = () => {
      // Haiku collection
      const haikus = [
        "Keep it simple now, Laser focus, step by stepâ€” Relentless progress.",
        "Keep it simple, clearâ€” Focused breath, unbroken stride. Progress never stops.",
        "Cut through noise and fog, Eyes forward, blade sharp with willâ€” Relentless advance.",
        "River carves through stone, Quiet, steady, unyielding. Simple, focused path."
      ];
      // Select random haiku on component mount
      const [selectedHaiku] = useState(() => {
        return haikus[Math.floor(Math.random() * haikus.length)];
      });

      // Authentication state
      const [user, setUser] = useState(null);
      const [authModalMode, setAuthModalMode] = useState('login');
      // Handle verification messages from URL
      useEffect(() => {
        const urlParams = new URLSearchParams(window.location.search);
        const verification = urlParams.get('verification');

        if (verification) {
          switch (verification) {
            case 'success':
              // Refresh user data to show verified status
              if (user) {
                checkAuth();
              }
              break;
            case 'invalid':
              setError('Invalid verification link');
              break;
            case 'already':
              // User already verified, just refresh
              if (user) {
                checkAuth();
              }
              break;
            case 'error':
              setError('Verification failed. Please try again.');
              break;
          }

          // Clean up URL
          window.history.replaceState({}, document.title, window.location.pathname);
        }
      }, [user]);
      const [authLoading, setAuthLoading] = useState(true);
      const [showAuthModal, setShowAuthModal] = useState(false);
      const [showEmailBanner, setShowEmailBanner] = useState(true);

      // Drag and drop state
      const [draggedTask, setDraggedTask] = useState(null);
      const [dragOverIndex, setDragOverIndex] = useState(null);
      const [draggedFromIndex, setDraggedFromIndex] = useState(null);

      // Drag and drop handlers
      const handleDragStart = (taskId, fromIndex) => {
        setDraggedTask(taskId);
        setDraggedFromIndex(fromIndex);
      };

      const handleDragEnd = () => {
        setDraggedTask(null);
        setDragOverIndex(null);
        setDraggedFromIndex(null);
      };

      const handleDragOver = (overIndex) => {
        setDragOverIndex(overIndex);
      };

      const handleDrop = async (toIndex) => {
        if (draggedTask && draggedFromIndex !== null && draggedFromIndex !== toIndex) {
          // Determine direction and call existing reorder API
          if (draggedFromIndex < toIndex) {
            // Moving down - need multiple moves
            for (let i = draggedFromIndex; i < toIndex; i++) {
              await moveTaskDown(draggedTask);
            }
          } else {
            // Moving up - need multiple moves  
            for (let i = draggedFromIndex; i > toIndex; i--) {
              await moveTaskUp(draggedTask);
            }
          }
        }
        handleDragEnd();
      };

      // Auto-load subtasks for all tasks when tasks change
      useEffect(() => {
        console.log('Subtask effect triggered. Tasks length:', tasks.length);

        if (tasks.length > 0) {
          console.log('Processing tasks for subtask loading...');
          tasks.forEach(task => {
            console.log(`Checking task ${task.id}: has subtasks?`, !!subtasks[task.id], 'loading?', !!loadingSubtasks[task.id]);

            if (!subtasks[task.id] && !loadingSubtasks[task.id]) {
              console.log(`Loading subtasks for task ${task.id}`);
              loadSubtasks(task.id);
            }
          });
        } else {
          console.log('No tasks to process for subtasks');
        }
      }, [tasks, currentBoard, subtasks, loadingSubtasks]); // Add missing dependencies

      // Subtask state
      const [subtasks, setSubtasks] = useState({});
      const [loadingSubtasks, setLoadingSubtasks] = useState({});

      const loadSubtasks = async (taskId) => {
        if (loadingSubtasks[taskId]) {
          console.log(`Already loading subtasks for task ${taskId}`);
          return;
        }

        try {
          console.log(`Starting to load subtasks for task ${taskId}`);
          setLoadingSubtasks(prev => ({ ...prev, [taskId]: true }));
          const subtasksData = await api.getSubtasks(taskId);
          console.log(`Loaded ${subtasksData.length} subtasks for task ${taskId}:`, subtasksData);
          setSubtasks(prev => ({ ...prev, [taskId]: subtasksData }));
        } catch (err) {
          console.error('Error loading subtasks:', err);
        } finally {
          setLoadingSubtasks(prev => ({ ...prev, [taskId]: false }));
        }
      };

      const addSubtask = async (taskId, title) => {
        if (!title.trim()) return;

        try {
          await api.createSubtask(taskId, title.trim());
          await loadSubtasks(taskId);
        } catch (err) {
          setError('Failed to add subtask: ' + err.message);
        }
      };

      const toggleSubtask = async (subtaskId, taskId) => {
        try {
          await api.toggleSubtask(subtaskId);
          await loadSubtasks(taskId);
        } catch (err) {
          setError('Failed to update subtask: ' + err.message);
        }
      };

      const deleteSubtask = async (subtaskId, taskId) => {
        try {
          await api.deleteSubtask(subtaskId);
          await loadSubtasks(taskId);
        } catch (err) {
          setError('Failed to delete subtask: ' + err.message);
        }
      };

      // Existing app state
      const [boards, setBoards] = useState([]);
      const [currentBoard, setCurrentBoard] = useState(null);
      const [tasks, setTasks] = useState([]);
      const [loading, setLoading] = useState(false);
      const [error, setError] = useState(null);

      // UI State
      const [activeTab, setActiveTab] = useState('active');
      const [deleteConfirm, setDeleteConfirm] = useState(null);
      const [editingTask, setEditingTask] = useState(null);
      const [newTask, setNewTask] = useState('');
      const [movingTask, setMovingTask] = useState(null);
      const [sidebarOpen, setSidebarOpen] = useState(false);
      const [windowWidth, setWindowWidth] = useState(typeof window !== 'undefined' ? window.innerWidth : 1280);
      const [showBoardModal, setShowBoardModal] = useState(false);
      const [editingBoard, setEditingBoard] = useState(null);
      const [newBoardName, setNewBoardName] = useState('');
      const [boardMenuOpen, setBoardMenuOpen] = useState(null);
      const [showQuickAddModal, setShowQuickAddModal] = useState(false);
      const [sessionExpired, setSessionExpired] = useState(false);

      // Check authentication on app load
      useEffect(() => {
        checkAuth();
      }, []);

      // Set up auth failure handler only for authenticated users
      useEffect(() => {
        if (user) {
          // Only set up session expiry handling for authenticated users
          api.setAuthFailureCallback((reason) => {
            if (reason === 'session_expired') {
              handleSessionExpiry();
            }
          });
        } else {
          // Clear the handler when no user
          api.setAuthFailureCallback(null);
        }
      }, [user]);

      // Load boards when user changes
      useEffect(() => {
        if (user) {
          loadBoards();
        }
      }, [user]);

      // Load tasks when board changes
      useEffect(() => {
        if (currentBoard && user) {
          loadTasks();
        }
      }, [currentBoard, user]);

      // Add this useEffect to see when tasks state changes
      useEffect(() => {
        console.log('Tasks state updated:', tasks.length, tasks);
      }, [tasks]);

      // Handle window resize
      useEffect(() => {
        const handleResize = () => setWindowWidth(window.innerWidth);
        const handleClickOutside = (e) => {
          if (boardMenuOpen && !e.target.closest('.board-menu-container')) {
            setBoardMenuOpen(null);
          }
        };

        window.addEventListener('resize', handleResize);
        document.addEventListener('mousedown', handleClickOutside);

        return () => {
          window.removeEventListener('resize', handleResize);
          document.removeEventListener('mousedown', handleClickOutside);
        };
      }, [boardMenuOpen]);

      const checkAuth = async () => {
        try {
          const result = await api.getCurrentUser();
          setUser(result.user);
        } catch (error) {
          setUser(null);
        } finally {
          setAuthLoading(false);
        }
      };

      const handleAuthSuccess = (userData) => {
        setUser(userData);
        setError(null);
        setSessionExpired(false); // Clear session expired flag
        setShowAuthModal(false);
      };

      const handleLogout = () => {
        api.clearCsrfToken();
        setUser(null);
        setBoards([]);
        setTasks([]);
        setCurrentBoard(null);
        setSubtasks({});
        setLoadingSubtasks({});
        setError(null);
        setSessionExpired(false);

        // Close any open modals
        setShowAuthModal(false);
        setEditingTask(null);
        setShowBoardModal(false);
        setEditingBoard(null);
        setBoardMenuOpen(null);
        setSidebarOpen(false);
      };

      // New session expiry handler - ADD THIS AFTER handleLogout
      const handleSessionExpiry = () => {
        handleLogout(); // Clear all state
        setSessionExpired(true); // Flag that session expired
        setShowAuthModal(true); // Show auth modal immediately
      };

      // API functions (unchanged but now require authentication)
      const loadBoards = async () => {
        try {
          console.log('Loading boards...');
          setLoading(true);
          const boardsData = await api.getBoards();
          console.log('Boards loaded:', boardsData);
          setBoards(boardsData);
          if (boardsData.length > 0 && !currentBoard) {
            console.log('Setting current board to:', boardsData[0].id);
            switchBoard(boardsData[0].id);
          }
          setError(null);
        } catch (err) {
          console.error('Error loading boards:', err);
          setError('Failed to load boards: ' + err.message);
        } finally {
          setLoading(false);
        }
      };

      const loadTasks = async () => {
        if (!currentBoard) return;

        try {
          const tasksData = await api.getTasks(currentBoard);
          console.log('Tasks API response:', tasksData);
          setTasks(tasksData);

          // Force subtask loading after a small delay to ensure state updates
          setTimeout(() => {
            tasksData.forEach(task => {
              if (!subtasks[task.id]) {
                console.log(`Force loading subtasks for task ${task.id} after task load`);
                loadSubtasks(task.id);
              }
            });
          }, 100);

          setError(null);
        } catch (err) {
          setError('Failed to load tasks: ' + err.message);
          console.error('Error loading tasks:', err);
        }
      };

      // All other functions remain the same...
      // (createBoard, editBoard, archiveBoard, task management functions)
      const createBoard = async () => {
        if (!newBoardName.trim()) return;

        try {
          const newBoard = await api.createBoard(newBoardName.trim());
          await loadBoards();
          setCurrentBoard(newBoard.id);
          setNewBoardName('');
          setShowBoardModal(false);
        } catch (err) {
          setError('Failed to create board: ' + err.message);
        }
      };

      const editBoard = async (boardId, newName) => {
        if (!newName.trim()) return;

        try {
          await api.updateBoard(boardId, newName.trim());
          await loadBoards();
          setEditingBoard(null);
        } catch (err) {
          setError('Failed to update board: ' + err.message);
        }
      };

      const archiveBoard = async (boardId) => {
        try {
          await api.deleteBoard(boardId);
          await loadBoards();
          setBoardMenuOpen(null);

          if (boardId === currentBoard) {
            const nextBoard = boards.find(b => b.id !== boardId && !b.archived);
            if (nextBoard) setCurrentBoard(nextBoard.id);
          }
        } catch (err) {
          setError('Failed to archive board: ' + err.message);
        }
      };

      // Task management functions (unchanged)
      const completeTask = async (taskId) => {
        try {
          await api.completeTask(taskId);
          await loadTasks();
        } catch (err) {
          setError('Failed to complete task: ' + err.message);
        }
      };

      const postponeTask = async (taskId) => {
        try {
          await api.postponeTask(taskId);
          await loadTasks();
        } catch (err) {
          setError('Failed to postpone task: ' + err.message);
        }
      };

      const deleteTask = async (taskId) => {
        try {
          await api.deleteTask(taskId);
          await loadTasks();
          setDeleteConfirm(null);
        } catch (err) {
          setError('Failed to delete task: ' + err.message);
        }
      };

      const promoteTask = async (taskId) => {
        setMovingTask(taskId);
        setTimeout(() => setMovingTask(null), 300);

        try {
          await api.promoteTask(taskId);
          await loadTasks();
        } catch (err) {
          setError('Failed to promote task: ' + err.message);
          setMovingTask(null);
        }
      };

      const demoteTask = async (taskId) => {
        setMovingTask(taskId);
        setTimeout(() => setMovingTask(null), 300);

        try {
          await api.demoteTask(taskId);
          await loadTasks();
        } catch (err) {
          setError('Failed to demote task: ' + err.message);
          setMovingTask(null);
        }
      };

      const moveTaskUp = async (taskId) => {
        setMovingTask(taskId);
        setTimeout(() => setMovingTask(null), 300);

        try {
          await api.reorderTask(taskId, 'up');
          await loadTasks();
        } catch (err) {
          setError('Failed to move task: ' + err.message);
          setMovingTask(null);
        }
      };

      const moveTaskDown = async (taskId) => {
        setMovingTask(taskId);
        setTimeout(() => setMovingTask(null), 300);

        try {
          await api.reorderTask(taskId, 'down');
          await loadTasks();
        } catch (err) {
          setError('Failed to move task: ' + err.message);
          setMovingTask(null);
        }
      };

      const addTask = async () => {
        if (!newTask.trim()) return;

        try {
          await api.createTask(currentBoard, newTask.trim());
          await loadTasks();
          setNewTask('');
        } catch (err) {
          setError('Failed to add task: ' + err.message);
        }
      };

      const editTask = (taskId) => {
        const task = tasks.find(t => t.id === taskId);
        setEditingTask({
          id: task.id,
          title: task.title,
          description: task.description || '',
          dueDate: task.dueDate ? new Date(task.dueDate).toISOString().slice(0, 16) : ''
        });

        // Load subtasks for this task
        loadSubtasks(taskId);
      };

      const saveEdit = async () => {
        try {
          await api.updateTask(
            editingTask.id,
            editingTask.title,
            editingTask.description,
            editingTask.dueDate || null
          );
          await loadTasks();
          setEditingTask(null);
        } catch (err) {
          setError('Failed to update task: ' + err.message);
        }
      };

      const undoComplete = async (taskId) => {
        try {
          await api.undoCompleteTask(taskId);
          await loadTasks();
        } catch (err) {
          setError('Failed to restore task: ' + err.message);
        }
      };

      // Helper functions
      const getBoardStats = (boardId) => {
        const activeTasks = tasks.filter(t => t.boardId === boardId && t.status === 'active').length;
        return `${activeTasks}/6`;
      };

      const switchBoard = (boardId) => {
        if (boardId !== currentBoard) {
          setSubtasks({}); // Clear subtasks when board changes
          setCurrentBoard(boardId);
        }
      };

      // Show auth loading screen
      if (authLoading) {
        return <LoadingScreen />;
      }

      // Show login modal if not authenticated
      if (!user) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
            <div className="text-center max-w-md mx-4">
              <img src="/SuperSix-Logo.png" alt="SuperSix" className="h-16 mx-auto mb-8" />
              <h1 className="text-3xl font-bold text-white mb-4">
                {sessionExpired ? 'Session Expired' : 'Welcome to SuperSix'}
              </h1>
              <p className="text-slate-300 whitespace-pre-line italic font-light leading-relaxed mb-8">
                {sessionExpired
                  ? 'Your session has expired for security. Please sign in again to continue.'
                  : selectedHaiku
                }
              </p>
              <div className="flex space-x-4 justify-center">
                <button
                  onClick={() => {
                    setAuthModalMode('login');
                    setShowAuthModal(true);
                  }}
                  className="bg-cyan-600 hover:bg-cyan-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                >
                  Sign In
                </button>
                {!sessionExpired && (
                  <button
                    onClick={() => {
                      setAuthModalMode('register');
                      setShowAuthModal(true);
                    }}
                    className="bg-orange-600 hover:bg-orange-700 text-white px-6 py-3 rounded-lg font-medium transition-colors"
                  >
                    Create Account
                  </button>
                )}
              </div>
            </div>

            <AuthModal
              isOpen={showAuthModal}
              onClose={() => {
                setShowAuthModal(false);
                setSessionExpired(false); // Clear expired flag if user cancels
              }}
              onAuthSuccess={handleAuthSuccess}
              mode={authModalMode}
            />
          </div>
        );
      }

      // Filter tasks by status
      const activeTasks = tasks
        .filter(task => task.status === 'active')
        .sort((a, b) => a.position - b.position)
        .slice(0, 6);

      const queuedTasks = tasks
        .filter(task => task.status === 'queued')
        .sort((a, b) => a.position - b.position);

      const completedTasks = tasks
        .filter(task => task.status === 'completed')
        .sort((a, b) => new Date(b.completedAt) - new Date(a.completedAt));

      if (loading && !user) {
        return <LoadingScreen />;
      }

      if (error && !boards.length) {
        return (
          <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex items-center justify-center">
            <div className="text-center max-w-md mx-4">
              <div className="bg-red-500/10 border border-red-500/20 rounded-lg p-6">
                <h2 className="text-red-400 font-semibold mb-2">Connection Error</h2>
                <p className="text-slate-300 mb-4">{error}</p>
                <button
                  onClick={() => {
                    setError(null);
                    setLoading(true);
                    loadBoards();
                  }}
                  className="bg-cyan-600 hover:bg-cyan-700 text-white px-4 py-2 rounded transition-colors"
                >
                  Retry
                </button>
              </div>
            </div>
          </div>
        );
      }

      return (
        <div className="min-h-screen bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 flex overflow-x-hidden">

          {/* Sidebar */}
          <div className={`fixed inset-y-0 left-0 z-50 w-64 bg-slate-800 border-r border-slate-700 transform transition-transform duration-300 ease-in-out ${sidebarOpen ? 'translate-x-0' : '-translate-x-full'}`} style={{ transform: windowWidth >= 1250 ? 'translateX(0)' : undefined, position: windowWidth >= 1250 ? 'static' : 'fixed' }}>
            <div className="flex items-center justify-between h-16 px-4 border-b border-slate-700">
              <h2 className="text-lg font-semibold text-white">Boards</h2>
              {windowWidth < 1250 && (
                <button
                  onClick={() => setSidebarOpen(false)}
                  className="text-slate-400 hover:text-white"
                >
                  <Icon name="x" size={20} />
                </button>
              )}
            </div>

            <div className="p-4 relative">
              <div className="space-y-2">
                {boards.filter(board => !board.archived).map(board => (
                  <div key={board.id} className="relative board-menu-container">
                    <div className={`flex items-center justify-between p-3 rounded-lg transition-colors ${board.id === currentBoard
                      ? 'bg-cyan-600 text-white shadow-lg shadow-cyan-600/20'
                      : 'text-slate-300 hover:bg-slate-700 hover:text-white'
                      }`}>
                      <button
                        onClick={() => {
                          switchBoard(board.id);
                          setSidebarOpen(false);
                        }}
                        className="flex-1 text-left"
                      >
                        <span className="font-medium">{board.name}</span>
                      </button>

                      <div className="flex items-center space-x-2">
                        <span className={`text-xs px-2 py-1 rounded ${board.id === currentBoard
                          ? 'bg-cyan-500 text-white'
                          : 'bg-slate-600 text-slate-300'
                          }`}>
                          {getBoardStats(board.id)}
                        </span>
                        <button
                          onClick={() => setBoardMenuOpen(boardMenuOpen === board.id ? null : board.id)}
                          className={`board-menu-button p-1 rounded transition-colors relative ${board.id === currentBoard
                            ? 'hover:bg-cyan-500 text-white'
                            : 'hover:bg-slate-600 text-slate-400'
                            } ${boardMenuOpen === board.id ? 'bg-slate-600' : ''}`}
                          title="Board options"
                        >
                          <Icon name="more-vertical" size={14} />
                        </button>
                      </div>
                    </div>

                    {/* Board Menu Dropdown */}
                    {boardMenuOpen === board.id && (
                      <div
                        className="board-menu-dropdown absolute right-3 top-full mt-1 bg-slate-700 border border-slate-600 rounded-lg shadow-xl w-36"
                        style={{ position: 'absolute', zIndex: 9999 }}
                      >
                        <button
                          onClick={() => {
                            setEditingBoard({ id: board.id, name: board.name });
                            setBoardMenuOpen(null);
                          }}
                          className="w-full px-3 py-2 text-left text-sm text-slate-300 hover:bg-slate-600 hover:text-white flex items-center space-x-2 rounded-t-lg"
                        >
                          <Icon name="edit" size={14} />
                          <span>Rename</span>
                        </button>
                        <button
                          onClick={() => archiveBoard(board.id)}
                          className="w-full px-3 py-2 text-left text-sm text-slate-300 hover:bg-slate-600 hover:text-white flex items-center space-x-2 rounded-b-lg"
                        >
                          <Icon name="archive" size={14} />
                          <span>Archive</span>
                        </button>
                      </div>
                    )}
                  </div>
                ))}
              </div>

              {/* Add Board Button */}
              <button
                onClick={() => setShowBoardModal(true)}
                className="w-full mt-4 p-3 border-2 border-dashed border-slate-600 rounded-lg text-slate-400 hover:border-slate-500 hover:text-slate-300 transition-colors flex items-center justify-center space-x-2"
              >
                <Icon name="plus" size={16} />
                <span>Add Board</span>
              </button>

              {/* Archived Boards Section */}
              {boards.some(b => b.archived) && (
                <div className="mt-6 pt-4 border-t border-slate-700">
                  <h3 className="text-sm font-medium text-slate-400 mb-2">Archived</h3>
                  <div className="space-y-1">
                    {boards.filter(board => board.archived).map(board => (
                      <div key={board.id} className="flex items-center justify-between p-2 text-slate-500 text-sm">
                        <span>{board.name}</span>
                        <button
                          onClick={() => restoreBoard(board.id)}
                          className="text-xs text-cyan-400 hover:text-cyan-300"
                        >
                          Restore
                        </button>
                      </div>
                    ))}
                  </div>
                </div>
              )}
            </div>
          </div>

          {/* Sidebar backdrop for mobile */}
          {sidebarOpen && windowWidth < 1250 && (
            <div
              className="fixed inset-0 bg-black bg-opacity-50 z-40"
              onClick={() => setSidebarOpen(false)}
            />
          )}

          {/* Main Content */}
          <div className="flex-1">
            {/* Mobile Header */}
            {windowWidth < 1250 && (
              <div className="flex items-center justify-between p-4 bg-slate-800 border-b border-slate-700">
                <button
                  onClick={() => setSidebarOpen(true)}
                  className="text-slate-400 hover:text-white"
                >
                  <Icon name="menu" size={24} />
                </button>
                <img src="/SuperSix-Logo.png" alt="SuperSix" className="h-8" />
                <UserHeader
                  user={user}
                  onLogout={handleLogout}
                  onOpenAuth={() => setShowAuthModal(true)}
                />
              </div>
            )}

            {/* Desktop Header */}
            {windowWidth >= 1250 && (
              <div className="flex items-center justify-between p-6 border-b border-slate-700">
                <div className="text-center flex-1">
                  <img src="/SuperSix-Logo.png" alt="SuperSix" className="h-12 mx-auto mb-2" />
                  <p className="text-slate-300 whitespace-pre-line italic font-light leading-relaxed">
                    {selectedHaiku}
                  </p>
                </div>
                <div className="absolute right-6 top-6">
                  <UserHeader
                    user={user}
                    onLogout={handleLogout}
                    onOpenAuth={() => setShowAuthModal(true)}
                  />
                </div>
              </div>
            )}

            {/* Email Verification Banner */}
            {showEmailBanner && (
              <EmailVerificationBanner user={user} />
            )}

            <div className="container mx-auto px-2 py-8 max-w-4xl overflow-x-hidden">
              {/* Board Title for Mobile */}
              {windowWidth <= 1249 && (
                <div className="text-center mb-6">
                  <h2 className="text-2xl font-semibold text-white mb-1">
                    {boards.find(b => b.id === currentBoard)?.name || 'Loading...'}
                  </h2>
                  <p className="text-slate-400 text-sm">
                    {getBoardStats(currentBoard)} active tasks
                  </p>
                </div>
              )}

              {/* Tab Navigation with Add Button */}
              <div className={`mb-6 ${windowWidth >= 768 ? 'relative flex justify-center' : 'flex justify-center items-center space-x-4'}`}>
                <button
                  onClick={() => setShowQuickAddModal(true)}
                  className={`w-10 h-10 bg-orange-500 hover:bg-orange-600 text-white rounded-full flex items-center justify-center transition-all hover:shadow-lg shadow-orange-500/20 ${windowWidth >= 768 ? 'absolute left-0 top-1/2 transform -translate-y-1/2' : ''}`}
                  title="Add new task"
                >
                  <Icon name="plus" size={20} />
                </button>

                <div className="bg-slate-800 rounded-lg p-1">
                  <button
                    onClick={() => setActiveTab('active')}
                    className={`px-6 py-2 rounded-md transition-all ${activeTab === 'active' ? 'bg-cyan-500 text-white shadow-lg' : 'text-slate-300 hover:text-white'}`}
                  >
                    Active & Queue
                  </button>
                  <button
                    onClick={() => setActiveTab('completed')}
                    className={`px-6 py-2 rounded-md transition-all ${activeTab === 'completed' ? 'bg-cyan-500 text-white shadow-lg' : 'text-slate-300 hover:text-white'}`}
                  >
                    Completed
                  </button>
                </div>
              </div>

              {/* Content */}
              {activeTab === 'active' ? (
                <div className="space-y-8">
                  {/* Active Focus Section */}
                  <div>
                    <h2 className="text-xl font-semibold text-white mb-4 flex items-center">
                      <span className="w-2 h-2 bg-cyan-400 rounded-full mr-3"></span>
                      Active Focus (1-6)
                    </h2>

                    <div className="space-y-3">
                      {Array.from({ length: 6 }, (_, slotIndex) => {
                        const task = activeTasks[slotIndex];
                        const isCurrentFocus = slotIndex === 0;

                        return task ? (
                          <TaskCard
                            key={`${task.id}-${task.position}`}
                            task={task}
                            index={slotIndex}
                            isCurrentFocus={isCurrentFocus}
                            onComplete={completeTask}
                            onPostpone={postponeTask}
                            onEdit={editTask}
                            onDelete={(taskId) => setDeleteConfirm(taskId)}
                            onMoveUp={moveTaskUp}
                            onMoveDown={moveTaskDown}
                            onDemote={demoteTask}
                            canMoveUp={slotIndex > 0}
                            canMoveDown={slotIndex < activeTasks.length - 1}
                            isMoving={movingTask === task.id}
                            onDragStart={handleDragStart}
                            onDragEnd={handleDragEnd}
                            onDragOver={handleDragOver}
                            onDrop={handleDrop}
                            isDragOver={dragOverIndex === slotIndex}
                            subtasks={subtasks}
                          />
                        ) : (
                          <div
                            key={slotIndex}
                            className="relative bg-slate-800 rounded-lg p-4 border-2 border-dashed border-slate-600"
                          >
                            <div className="absolute left-0 -top-3 w-8 h-8 rounded-full flex items-center justify-center text-sm font-bold bg-slate-700 text-slate-300">
                              {slotIndex + 1}
                            </div>
                            <div className="ml-4 text-slate-500 italic">
                              Empty slot - promote from queue or add new task
                            </div>
                          </div>
                        );
                      })}
                    </div>
                  </div>

                  {/* Task Queue Section */}
                  <div>
                    <div className="border-t border-slate-700 pt-8">
                      <h2 className="text-xl font-semibold text-white mb-4 flex items-center">
                        <span className="w-2 h-2 bg-orange-400 rounded-full mr-3"></span>
                        Task Queue ({queuedTasks.length})
                      </h2>

                      {queuedTasks.length > 0 ? (
                        <div className="space-y-2">
                          {queuedTasks.map((task, index) => (
                            <QueueCard
                              key={`${task.id}-${task.position}`}
                              task={task}
                              index={index}
                              onEdit={editTask}
                              onDelete={(taskId) => setDeleteConfirm(taskId)}
                              onMoveUp={moveTaskUp}
                              onMoveDown={moveTaskDown}
                              onPromote={promoteTask}
                              canMoveUp={index > 0}
                              canMoveDown={index < queuedTasks.length - 1}
                              isMoving={movingTask === task.id}
                              subtasks={subtasks}
                            />
                          ))}
                        </div>
                      ) : (
                        <div className="text-slate-500 italic text-center py-8">
                          Queue is empty - add tasks to build momentum
                        </div>
                      )}

                      {/* Add Task Input */}
                      <div className="mt-4">
                        <div className="flex space-x-2">
                          <input
                            type="text"
                            value={newTask}
                            onChange={(e) => setNewTask(e.target.value)}
                            onKeyPress={(e) => e.key === 'Enter' && addTask()}
                            placeholder="Add new task to queue..."
                            className="flex-1 bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-400"
                          />
                          <button
                            onClick={addTask}
                            disabled={!newTask.trim()}
                            className="bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white px-4 py-2 rounded font-medium transition-colors"
                          >
                            Add
                          </button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              ) : (
                /* Completed Tasks */
                <div>
                  <h2 className="text-xl font-semibold text-white mb-4">Completed Tasks</h2>
                  {completedTasks.length > 0 ? (
                    <div className="space-y-2">
                      {completedTasks.map(task => (
                        <div key={task.id} className="bg-slate-800/50 rounded-lg p-3 border border-green-500/30">
                          <div className="flex justify-between items-start">
                            <div>
                              <h4 className="text-white font-medium line-through opacity-75">{task.title}</h4>
                              <p className="text-slate-400 text-sm">
                                Completed: {new Date(task.completedAt).toLocaleString()}
                              </p>
                            </div>
                            <button
                              onClick={() => undoComplete(task.id)}
                              className="text-yellow-400 hover:text-yellow-300 text-sm"
                            >
                              Undo
                            </button>
                          </div>
                        </div>
                      ))}
                    </div>
                  ) : (
                    <p className="text-slate-500 italic text-center py-8">No completed tasks yet</p>
                  )}
                </div>
              )}
            </div>
          </div>

          {/* Modals */}

          {/* Quick Add Task Modal */}
          <QuickAddModal
            isOpen={showQuickAddModal}
            onClose={() => setShowQuickAddModal(false)}
            onAdd={(taskTitle) => {
              if (currentBoard) {
                api.createTask(currentBoard, taskTitle).then(() => {
                  loadTasks();
                }).catch(err => {
                  setError('Failed to add task: ' + err.message);
                });
              }
            }}
            loading={loading}
          />

          {/* Auth Modal */}
          <AuthModal
            isOpen={showAuthModal}
            onClose={() => setShowAuthModal(false)}
            onAuthSuccess={handleAuthSuccess}
          />

          {/* Create Board Modal */}
          {showBoardModal && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
              <div className="bg-slate-800 rounded-lg p-6 max-w-md mx-4 border border-slate-700 w-full">
                <h3 className="text-white font-semibold mb-4">Create New Board</h3>

                <div className="space-y-4">
                  <div>
                    <label className="block text-slate-300 text-sm font-medium mb-1">Board Name</label>
                    <input
                      type="text"
                      value={newBoardName}
                      onChange={(e) => setNewBoardName(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && createBoard()}
                      placeholder="e.g., Side Projects, Health Goals..."
                      className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white placeholder-slate-400 focus:outline-none focus:border-cyan-400"
                      autoFocus
                    />
                  </div>
                </div>

                <div className="flex space-x-2 justify-end mt-6">
                  <button
                    onClick={() => {
                      setShowBoardModal(false);
                      setNewBoardName('');
                    }}
                    className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={createBoard}
                    disabled={!newBoardName.trim()}
                    className="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded transition-colors"
                  >
                    Create Board
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Edit Board Modal */}
          {editingBoard && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
              <div className="bg-slate-800 rounded-lg p-6 max-w-md mx-4 border border-slate-700 w-full">
                <h3 className="text-white font-semibold mb-4">Rename Board</h3>

                <div className="space-y-4">
                  <div>
                    <label className="block text-slate-300 text-sm font-medium mb-1">Board Name</label>
                    <input
                      type="text"
                      value={editingBoard.name}
                      onChange={(e) => setEditingBoard({ ...editingBoard, name: e.target.value })}
                      onKeyPress={(e) => e.key === 'Enter' && editBoard(editingBoard.id, editingBoard.name)}
                      className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-400"
                      autoFocus
                    />
                  </div>
                </div>

                <div className="flex space-x-2 justify-end mt-6">
                  <button
                    onClick={() => setEditingBoard(null)}
                    className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={() => editBoard(editingBoard.id, editingBoard.name)}
                    disabled={!editingBoard.name.trim()}
                    className="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded transition-colors"
                  >
                    Save
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Edit Task Modal */}
          {editingTask && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
              <div className="bg-slate-800 rounded-lg p-6 max-w-md mx-4 border border-slate-700 w-full">
                <h3 className="text-white font-semibold mb-4">Edit Task</h3>

                <div className="space-y-4">
                  <div>
                    <label className="block text-slate-300 text-sm font-medium mb-1">Title</label>
                    <input
                      type="text"
                      value={editingTask.title}
                      onChange={(e) => setEditingTask({ ...editingTask, title: e.target.value })}
                      onKeyPress={(e) => e.key === 'Enter' && saveEdit()}
                      className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-400"
                      autoFocus
                    />
                  </div>

                  <div>
                    <label className="block text-slate-300 text-sm font-medium mb-1">Description</label>
                    <textarea
                      value={editingTask.description}
                      onChange={(e) => setEditingTask({ ...editingTask, description: e.target.value })}
                      rows={3}
                      className="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-400 resize-none"
                      placeholder="Optional description..."
                    />
                  </div>

                  <div>
                    <label className="block text-slate-300 text-sm font-medium mb-1">Due Date & Time (PST)</label>
                    <div className="grid grid-cols-2 gap-2">
                      <input
                        type="date"
                        value={editingTask.dueDate ? editingTask.dueDate.split('T')[0] : ''}
                        onChange={(e) => {
                          const currentTime = editingTask.dueDate ? editingTask.dueDate.split('T')[1] || '09:00' : '09:00';
                          setEditingTask({
                            ...editingTask,
                            dueDate: e.target.value ? `${e.target.value}T${currentTime}` : ''
                          });
                        }}
                        className="bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-400"
                        placeholder="Date"
                      />
                      <select
                        value={editingTask.dueDate ? editingTask.dueDate.split('T')[1]?.substring(0, 5) || '09:00' : '09:00'}
                        onChange={(e) => {
                          const currentDate = editingTask.dueDate ? editingTask.dueDate.split('T')[0] : new Date().toISOString().split('T')[0];
                          setEditingTask({
                            ...editingTask,
                            dueDate: currentDate ? `${currentDate}T${e.target.value}` : ''
                          });
                        }}
                        className="bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white focus:outline-none focus:border-cyan-400"
                      >
                        {Array.from({ length: 48 }, (_, i) => {
                          const hour = Math.floor(i / 2);
                          const minute = (i % 2) * 30;
                          const time24 = `${hour.toString().padStart(2, '0')}:${minute.toString().padStart(2, '0')}`;
                          const hour12 = hour === 0 ? 12 : hour > 12 ? hour - 12 : hour;
                          const ampm = hour < 12 ? 'AM' : 'PM';
                          const time12 = `${hour12}:${minute.toString().padStart(2, '0')} ${ampm}`;

                          return (
                            <option key={time24} value={time24}>
                              {time12}
                            </option>
                          );
                        })}
                      </select>
                    </div>
                  </div>
                </div>

                <div>
                  <SubtaskList
                    taskId={editingTask.id}
                    subtasks={subtasks}
                    onAdd={addSubtask}
                    onToggle={toggleSubtask}
                    onDelete={deleteSubtask}
                    loading={loadingSubtasks[editingTask.id]}
                  />
                </div>

                <div className="flex space-x-2 justify-end mt-6">
                  <button
                    onClick={() => setEditingTask(null)}
                    className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={saveEdit}
                    disabled={!editingTask.title.trim()}
                    className="px-4 py-2 bg-cyan-600 hover:bg-cyan-700 disabled:bg-slate-600 disabled:cursor-not-allowed text-white rounded transition-colors"
                  >
                    Save
                  </button>
                </div>
              </div>
            </div>
          )}

          {/* Delete Confirmation Modal */}
          {deleteConfirm && (
            <div className="fixed inset-0 bg-black/50 flex items-center justify-center z-50">
              <div className="bg-slate-800 rounded-lg p-6 max-w-sm mx-4 border border-slate-700">
                <h3 className="text-white font-semibold mb-2">Delete Task</h3>
                <p className="text-slate-300 mb-4">
                  Are you sure you want to delete this task permanently? This action cannot be undone.
                </p>
                <div className="flex space-x-2 justify-end">
                  <button
                    onClick={() => setDeleteConfirm(null)}
                    className="px-4 py-2 bg-slate-600 hover:bg-slate-700 text-white rounded transition-colors"
                  >
                    Cancel
                  </button>
                  <button
                    onClick={() => deleteTask(deleteConfirm)}
                    className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded transition-colors"
                  >
                    Delete
                  </button>
                </div>
              </div>
            </div>
          )}
        </div>
      );
    };

    ReactDOM.render(<App />, document.getElementById('root'));
  </script>
</body>

</html>